# IOCP 기반 MMORPG 게임 서버

> 대규모 동시 접속과 실시간 전투 처리를 위한 C++ IOCP MMORPG 서버  
![Image](https://github.com/user-attachments/assets/657a8f98-df12-4bb2-904b-fcf83112358d)

## 프로젝트 개요

- **프로젝트명**: IOCP 대규모 처리를 통한 MMORPG 서버
- **개발 기간**: 2024.07.06 ~ 2024.07.18
- **개발 인원**: 1명
- **개발 환경**:  
  - C++ / Visual Studio 2022  
  - WinSock2.h / IOCP  
  - MSSQL / ODBC  


## 실행 방법

### 서버 실행

1. Visual Studio 2022로 서버 프로젝트 열기  
2. `MSSQL`에서 제공된 `2024_GameServer.bak` 파일 복원  
3. ODBC 데이터 소스 관리자 설정
   - **사용자 DSN > 추가 > SQL Server**  
   - **ODBC 이름을 `2024_GameServer`로 설정**, 연결할 SQL Server 선택  
4. 2024_GameServer_Term.exe 실행  

### 클라이언트 실행

1. Visual Studio 2022로 클라이언트 프로젝트 열기  
2. 실행 시 콘솔 창에서 **서버 IP 입력**  
3. **사용할 ID 입력**  
   - 존재하지 않으면 자동 생성 → DB에 INSERT  
   - 존재할 경우 → 마지막 좌표/레벨/체력으로 이어서 접속  
   - **이미 접속 중인 ID는 차단됨**



## 프로젝트 구조
```
2024_TUK_GameServer_Term/
├── SERVER/
│ ├── DB           # ODBC + MSSQL 연동 관련 DB 작업 및 쿼리 처리
│ │ └── 2024_GameServer.bak
│ ├── MainServer   # 서버 진입점. IOCP 초기화 및 쓰레드풀, accept 처리 등
│ ├── Player       # 플레이어 상태, 입력, 충돌, 이동 및 전투 처리
│ ├── Session      # 세션 구조 관리 (세션별 플레이어 컨테이너 및 시야처리 등)
│ ├── NPC          # 몬스터 및 NPC AI, 이동, 상태
│ └── Timer        # 서버 타이머 시스템 (AI 이동, 타임 이벤트 등 주기 처리)
├── CLIENT/client_sample
│ └── client.cpp   # 사용자 클라이언트. 입력 송신 및 위치 렌더링
└── README.md
```

---

## 구현 기능

### 이동

- 방향키 입력으로 이동 처리 (앞/뒤/좌/우)
- 이동 시 1초에 한 번 처리 (공격과 동일 주기)
- **시야 동기화 시스템 적용**  
  - 전체 맵 크기: 2000x2000  
  - 15칸 단위로 섹터 구분하여 주변 동기화



### 전투 시스템

- `A 키`: 4방향 전체 공격 (상하좌우, 데미지 5)
- `S 키`: 마지막 이동 방향 기준 단일 방향 공격 (데미지 10)
- 몬스터는 20만 마리 소환 가능  
  - 각 몬스터는 랜덤한 레벨과 체력을 가짐
- 몬스터 처치 시 경험치 획득 → 클라이언트 UI 실시간 반영



### 전투 이벤트 처리

- 공격 시 메시지 브로드캐스팅:  
  **"누가 누구에게 몇 데미지를 입힘"**
- 메시지는 **대상 오브젝트의 View List 내 클라이언트에게만 전송**
- 오브젝트 사망 시:
  - 죽은 객체 제거 처리
  - 처치한 플레이어는 `레벨 * 레벨 * 2` 경험치 획득



### 데이터베이스 연동 (MSSQL)

- `ODBC`를 통한 DB 연결  
- **스레드 기반 DB 작업 큐** (concurrent_queue)
- 로그인 / 로그아웃 시 DB 연동 처리
- 로그인 시 처리:
  - **존재하지 않는 ID**: 새로 INSERT
  - **기존 ID**: 마지막 좌표, 레벨 등 상태 복원
  - **이미 접속 중인 ID**: 중복 로그인 차단



### 채팅 시스템

- Enter 입력 → 채팅 입력 → Enter 입력으로 서버 전송
- 모든 클라이언트에게 브로드캐스트
- 채팅 메시지는:
  - 클라이언트 하단 채팅창에 누적 표시
  - 메시지 보낸 유저 머리 위에 **3초간 출력**



### UI 구성

- 클라이언트 상단:
  - 체력 / 경험치 / 레벨
- 캐릭터 머리 위: 실시간 체력 표시
- 채팅창: 채팅 + 전투 로그 표시
- 우측 상단 미니맵
- 체력/경험치 바 실시간 갱신


